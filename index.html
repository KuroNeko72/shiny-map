<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>è¨ªå•å…ˆãƒãƒƒãƒ—</title>
    <style>
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
      #search-container {
        position: absolute;
        top: 10px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 999;
        background: white;
        padding: 8px 12px;
        border-radius: 8px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.3);
      }
      #map {
        height: 100%;
      }
      #search-input {
        width: 300px;
        padding: 6px;
        font-size: 14px;
      }
    </style>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBe8z63G6IyDacbjrcN4Yj1ffT7m0U48wg&callback=initMap" async defer></script>
    <script>
      let map;
      let markers = [];

      function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
          zoom: 13,
          center: { lat: 35.71006, lng: 139.8107 }
        });

        const icons = {
          "å¯": "http://maps.google.com/mapfiles/ms/icons/red-dot.png",
          "ä¸å¯": "http://maps.google.com/mapfiles/ms/icons/blue-dot.png",
          "æœªç¢ºèª": "http://maps.google.com/mapfiles/ms/icons/green-dot.png"
        };

        fetch("https://script.googleusercontent.com/macros/echo?user_content_key=AehSKLi_MUyKuabYCEacuEOQr9DhUDiB0t0yRuKdLL4NMRT-DW4MCPN-pgzOmpwyPbMmYVnfu8Y7n4XX4EAsK454yx3MhffWkZcJ-zpg1kKKHxoSQ9yhD0mwtxSYAnWFBKVcMWgsSbC8xbZ_yzjI4mjSFiXga6V88L8vRyO9_U3J9XeyEEXCmI0tfFP27RWjgB-Z8luFgpo6k1pKJypR8mXXfCPJdkkuN_cP634KmNFjUOux8_gJbDMjIOCOGEFdr2UDiitCIDqzTtJcHXAuYxyvo8Gc4FlePEWGzWJrm346&lib=MavVMtVIJN2j1dWEVARyyVyNB014Mn1gM")
          .then(response => response.json())
          .then(data => {
            createMarkers(data);

            // æ¤œç´¢ã‚¤ãƒ™ãƒ³ãƒˆ
            const input = document.getElementById("search-input");
            input.addEventListener("input", () => {
              const keyword = input.value.trim();
              const filtered = data.filter(entry => entry["æ–½è¨­å"].includes(keyword));
              clearMarkers();
              createMarkers(filtered);
            });
          });

        function createMarkers(data) {
          const geocoder = new google.maps.Geocoder();
          data.forEach(entry => {
            const name = entry['æ–½è¨­å'];
            const address = entry['ä½æ‰€'];
            const status = entry['å—ã‘å–ã‚Šå¯å¦'] || "æœªç¢ºèª";
            const rawDate = entry['å‰å›è¨ªå•'];
            const visitor = entry['è¨ªå•è€…'] || "ä¸æ˜";

            let visitDate = "æœªå…¥åŠ›";
            if (rawDate && rawDate !== "æœªå…¥åŠ›") {
              const d = new Date(rawDate);
              const yyyy = d.getFullYear();
              const mm = ("0" + (d.getMonth() + 1)).slice(-2);
              const dd = ("0" + d.getDate()).slice(-2);
              visitDate = `${yyyy}/${mm}/${dd}`;
            }

            const icon = icons[status] || icons["æœªç¢ºèª"];
            const infoWindow = new google.maps.InfoWindow({
              content: `
                <div style="text-align: left; line-height: 1.4;">
                  <strong>${name}</strong><br>
                  å—ã‘å–ã‚Šå¯å¦ï¼š${status}<br>
                  å‰å›è¨ªå•ï¼š${visitDate}ã€€è¨ªå•è€…ï¼š${visitor}
                </div>`
            });

            geocoder.geocode({ address: address }, (results, status) => {
              if (status === "OK") {
                const marker = new google.maps.Marker({
                  map: map,
                  position: results[0].geometry.location,
                  title: name,
                  icon: icon
                });

                marker.addListener("click", () => {
                  map.panTo(marker.getPosition()); // ğŸ“Œ ã‚¯ãƒªãƒƒã‚¯ã§ä¸­å¤®ã«ç§»å‹•
                  infoWindow.open(map, marker);
                });

                markers.push(marker);
              } else {
                console.error("ã‚¸ã‚ªã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°å¤±æ•—: " + status + "ï¼ˆä½æ‰€: " + address + "ï¼‰");
              }
            });
          });
        }

        function clearMarkers() {
          markers.forEach(marker => marker.setMap(null));
          markers = [];
        }
      }
    </script>
  </head>
  <body>
    <div id
